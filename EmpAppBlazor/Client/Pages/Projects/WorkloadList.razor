@page "/workload/list"
@inject IWorkloadServiceClient WorkloadService

<MudDataGrid T="WorkloadGetDTO" Items="@WorkloadService.Workloads" EditMode="DataGridEditMode.Cell"
    StartedEditingItem="@StartedEditingItem" CancelledEditingItem="@CancelledEditingItem" CommittedItemChanges="@CommittedItemChanges"
    Bordered="true" Dense="true" EditTrigger="DataGridEditTrigger.OnRowClick">
    <Columns>
        <Column T="WorkloadGetDTO" Field="DeliveryDate" />
        <Column T="WorkloadGetDTO" Field="ProductionStage" />
        <Column T="WorkloadGetDTO" CellClass="d-flex justify-end">
            <CellTemplate>
                <MudIconButton Size="@Size.Small" Icon="@Icons.Outlined.Edit" OnClick="@context.Actions.StartEditingItem" />
            </CellTemplate>
        </Column>
    </Columns>
</MudDataGrid>


@*<MudTable Items="@WorkloadService.Workloads" Hover="true" Striped="true" Bordered="true" Dense="true"
          CustomHeader="true" CustomFooter="true" HeaderClass="table-head-bordered" FooterClass="table-foot-bordered">
    <HeaderContent>
        <MudTHeadRow Class="header-centered">
            <MudTh colspan="10">Workloads</MudTh>
        </MudTHeadRow>
        <MudTHeadRow Class="header-centered">
            <MudTh colspan="1"></MudTh>
            <MudTh colspan="2">Project</MudTh>
            <MudTh colspan="7">Info</MudTh>
        </MudTHeadRow>
        <MudTHeadRow>
            <MudTh>Id</MudTh>
            <MudTh>Number</MudTh>
            <MudTh>Name</MudTh>
            <MudTh>Production Stage</MudTh>
            <MudTh>Delivery Date</MudTh>
            <MudTh>Required Date</MudTh>
            <MudTh>Order Placed</MudTh>
            <MudTh>Design Leader</MudTh>
            <MudTh>Comments</MudTh>
            <MudTh>Actions</MudTh>
        </MudTHeadRow>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.Id</MudTd>
        <MudTd>@context.Project.Number</MudTd>
        <MudTd>@context.Project.Name</MudTd>
        <MudTd>@context.ProductionStage</MudTd>
        <MudTd>@context.DeliveryDate?.ToString("dd/MMM/yyyy")</MudTd>
        <MudTd>@context.RequiredDate?.ToString("dd/MMM/yyyy")</MudTd>
        <MudTd>@context.OrderPlaced?.ToString("dd/MMM/yyyy")</MudTd>
        <MudTd>@context.DesignLeader.Name @context.DesignLeader.Surname</MudTd>
        <MudTd>@context.Comments</MudTd>
        <MudTd>--actions-btns--</MudTd>
    </RowTemplate>
</MudTable>*@

@code {
    protected override async Task OnInitializedAsync()
    {
        await WorkloadService.GetWorkloads();
    }

    private List<string> _events = new();
    private bool _editTriggerRowClick;

        // events
    void StartedEditingItem(WorkloadGetDTO item)
    {
        _events.Insert(0, $"Event = StartedEditingItem, Data = {System.Text.Json.JsonSerializer.Serialize(item)}");
    }

    void CancelledEditingItem(WorkloadGetDTO item)
    {
        _events.Insert(0, $"Event = CancelledEditingItem, Data = {System.Text.Json.JsonSerializer.Serialize(item)}");
    }

    void CommittedItemChanges(WorkloadGetDTO item)
    {
        _events.Insert(0, $"Event = CommittedItemChanges, Data = {System.Text.Json.JsonSerializer.Serialize(item)}");
    }
}
